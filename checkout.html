<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - GameStore</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="checkout-container">
    <h1>Resumen de tu pedido</h1>

    <section id="datos-usuario" class="datos-usuario">
      <h2>Datos del cliente</h2>
      <p><strong>Nombre:</strong> <span id="nombre"></span></p>
      <p><strong>Apellido:</strong> <span id="apellido"></span></p>
      <p><strong>Teléfono:</strong> <span id="telefono"></span></p>
      <p><strong>Correo:</strong> <span id="correo"></span></p>
    </section>

    <section id="lista-carrito" class="lista-carrito">
      <h2>Juegos seleccionados</h2>
      <ul id="carrito"></ul>
    </section>

    <section class="metodos-pago">
      <h2>Métodos de pago</h2>
      <ul>
        <li><strong>Pago Móvil:</strong> 22123456 4121234567 (Banesco)</li>
        <li><strong>Depósito en efectivo:</strong></li>
        <li>Bancamiga: #123456789</li>
        <li>Mercantil: #987654321</li>
      </ul>
    </section>

    <section class="cotizacion-final">
      <h2>Cotización</h2>
      <p><strong>Número de cotización:</strong> <span id="cotizacion"></span></p>
      <button id="confirmar-pedido">Confirmar pedido</button>
    </section>
  </main>

  <script type="module">
    import { auth } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Mostrar carrito
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const ul = document.getElementById("carrito");
    carrito.forEach(item => {
      const li = document.createElement("li");
      li.textContent = `${item.titulo} (${item.tipo})`;
      ul.appendChild(li);
    });

    // Mostrar datos del usuario
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      document.getElementById("correo").textContent = user.email;
      document.getElementById("nombre").textContent = user.displayName || "Nombre no definido";

      // Extraer nombre y apellido si está separado por espacio
      const partes = user.displayName ? user.displayName.split(" ") : [];
      document.getElementById("nombre").textContent = partes[0] || "";
      document.getElementById("apellido").textContent = partes[1] || "";
      document.getElementById("telefono").textContent = localStorage.getItem("telefono") || "No guardado";
    });

    // Número de cotización secuencial
    function generarCotizacion() {
      let ultima = localStorage.getItem("ultimaCotizacion") || "000000";
      let nueva = (parseInt(ultima) + 1).toString().padStart(6, "0");
      localStorage.setItem("ultimaCotizacion", nueva);
      return nueva;
    }

    const numeroCotizacion = generarCotizacion();
    document.getElementById("cotizacion").textContent = numeroCotizacion;

    document.getElementById("confirmar-pedido").addEventListener("click", () => {
      alert(`Pedido confirmado. Tu número de cotización es ${numeroCotizacion}`);
      localStorage.removeItem("carrito");
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
